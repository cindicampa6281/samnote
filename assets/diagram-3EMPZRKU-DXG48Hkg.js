import{s as de}from"./chunk-SKB7J2MH-BAmcrV0Y.js";import{_ as x,s as ue,g as pe,m as he,n as fe,b as ge,c as me,l as Q,C as ae,B as ne,ag as ye,r as Se,F as ve,j as xe,ah as R,A as be}from"./mermaid.core-D183mPaz.js";import{p as we}from"./chunk-353BL4L5-UtboBlFu.js";import{I as Ce}from"./chunk-AACKK3MU-1gaS24Z6.js";import{p as Le}from"./treemap-6Y5VK53G-CDW72OgL.js";import{s as U}from"./isEmpty-DZjfmkgt.js";import{b as O}from"./defaultLocale-C4B-KCzX.js";import{o as K}from"./ordinal-Cboi1Yqb.js";import"./index-351BowlP.js";import"./line-CTn1KoI1.js";import"./array-BKyUJesY.js";import"./path-CbwjOpE9.js";import"./_baseUniq-ZOHLYKKq.js";import"./_basePickBy-uLgl76X4.js";import"./has-DLOap5qx.js";import"./clone-C8pvnE6i.js";import"./init-Gi6I4Gst.js";function Te(e){var a=0,r=e.children,n=r&&r.length;if(!n)a=1;else for(;--n>=0;)a+=r[n].value;e.value=a}function $e(){return this.eachAfter(Te)}function Fe(e,a){let r=-1;for(const n of this)e.call(a,n,++r,this);return this}function Ne(e,a){for(var r=this,n=[r],i,l,d=-1;r=n.pop();)if(e.call(a,r,++d,this),i=r.children)for(l=i.length-1;l>=0;--l)n.push(i[l]);return this}function ke(e,a){for(var r=this,n=[r],i=[],l,d,p,g=-1;r=n.pop();)if(i.push(r),l=r.children)for(d=0,p=l.length;d<p;++d)n.push(l[d]);for(;r=i.pop();)e.call(a,r,++g,this);return this}function Ae(e,a){let r=-1;for(const n of this)if(e.call(a,n,++r,this))return n}function _e(e){return this.eachAfter(function(a){for(var r=+e(a.data)||0,n=a.children,i=n&&n.length;--i>=0;)r+=n[i].value;a.value=r})}function ze(e){return this.eachBefore(function(a){a.children&&a.children.sort(e)})}function Me(e){for(var a=this,r=Ve(a,e),n=[a];a!==r;)a=a.parent,n.push(a);for(var i=n.length;e!==r;)n.splice(i,0,e),e=e.parent;return n}function Ve(e,a){if(e===a)return e;var r=e.ancestors(),n=a.ancestors(),i=null;for(e=r.pop(),a=n.pop();e===a;)i=e,e=r.pop(),a=n.pop();return i}function Pe(){for(var e=this,a=[e];e=e.parent;)a.push(e);return a}function Be(){return Array.from(this)}function Re(){var e=[];return this.eachBefore(function(a){a.children||e.push(a)}),e}function De(){var e=this,a=[];return e.each(function(r){r!==e&&a.push({source:r.parent,target:r})}),a}function*We(){var e=this,a,r=[e],n,i,l;do for(a=r.reverse(),r=[];e=a.pop();)if(yield e,n=e.children)for(i=0,l=n.length;i<l;++i)r.push(n[i]);while(r.length)}function ee(e,a){e instanceof Map?(e=[void 0,e],a===void 0&&(a=He)):a===void 0&&(a=Ie);for(var r=new Z(e),n,i=[r],l,d,p,g;n=i.pop();)if((d=a(n.data))&&(g=(d=Array.from(d)).length))for(n.children=d,p=g-1;p>=0;--p)i.push(l=d[p]=new Z(d[p])),l.parent=n,l.depth=n.depth+1;return r.eachBefore(Ge)}function Ee(){return ee(this).eachBefore(Oe)}function Ie(e){return e.children}function He(e){return Array.isArray(e)?e[1]:null}function Oe(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function Ge(e){var a=0;do e.height=a;while((e=e.parent)&&e.height<++a)}function Z(e){this.data=e,this.depth=this.height=0,this.parent=null}Z.prototype=ee.prototype={constructor:Z,count:$e,each:Fe,eachAfter:ke,eachBefore:Ne,find:Ae,sum:_e,sort:ze,path:Me,ancestors:Pe,descendants:Be,leaves:Re,links:De,copy:Ee,[Symbol.iterator]:We};function qe(e){if(typeof e!="function")throw new Error;return e}function G(){return 0}function q(e){return function(){return e}}function Xe(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function je(e,a,r,n,i){for(var l=e.children,d,p=-1,g=l.length,c=e.value&&(n-a)/e.value;++p<g;)d=l[p],d.y0=r,d.y1=i,d.x0=a,d.x1=a+=d.value*c}function Ye(e,a,r,n,i){for(var l=e.children,d,p=-1,g=l.length,c=e.value&&(i-r)/e.value;++p<g;)d=l[p],d.x0=a,d.x1=n,d.y0=r,d.y1=r+=d.value*c}var Ue=(1+Math.sqrt(5))/2;function Ze(e,a,r,n,i,l){for(var d=[],p=a.children,g,c,u=0,w=0,s=p.length,b,S,v=a.value,h,m,A,k,P,W,_;u<s;){b=i-r,S=l-n;do h=p[w++].value;while(!h&&w<s);for(m=A=h,W=Math.max(S/b,b/S)/(v*e),_=h*h*W,P=Math.max(A/_,_/m);w<s;++w){if(h+=c=p[w].value,c<m&&(m=c),c>A&&(A=c),_=h*h*W,k=Math.max(A/_,_/m),k>P){h-=c;break}P=k}d.push(g={value:h,dice:b<S,children:p.slice(u,w)}),g.dice?je(g,r,n,i,v?n+=S*h/v:l):Ye(g,r,n,v?r+=b*h/v:i,l),v-=h,u=w}return d}const Je=function e(a){function r(n,i,l,d,p){Ze(a,n,i,l,d,p)}return r.ratio=function(n){return e((n=+n)>1?n:1)},r}(Ue);function Ke(){var e=Je,a=!1,r=1,n=1,i=[0],l=G,d=G,p=G,g=G,c=G;function u(s){return s.x0=s.y0=0,s.x1=r,s.y1=n,s.eachBefore(w),i=[0],a&&s.eachBefore(Xe),s}function w(s){var b=i[s.depth],S=s.x0+b,v=s.y0+b,h=s.x1-b,m=s.y1-b;h<S&&(S=h=(S+h)/2),m<v&&(v=m=(v+m)/2),s.x0=S,s.y0=v,s.x1=h,s.y1=m,s.children&&(b=i[s.depth+1]=l(s)/2,S+=c(s)-b,v+=d(s)-b,h-=p(s)-b,m-=g(s)-b,h<S&&(S=h=(S+h)/2),m<v&&(v=m=(v+m)/2),e(s,S,v,h,m))}return u.round=function(s){return arguments.length?(a=!!s,u):a},u.size=function(s){return arguments.length?(r=+s[0],n=+s[1],u):[r,n]},u.tile=function(s){return arguments.length?(e=qe(s),u):e},u.padding=function(s){return arguments.length?u.paddingInner(s).paddingOuter(s):u.paddingInner()},u.paddingInner=function(s){return arguments.length?(l=typeof s=="function"?s:q(+s),u):l},u.paddingOuter=function(s){return arguments.length?u.paddingTop(s).paddingRight(s).paddingBottom(s).paddingLeft(s):u.paddingTop()},u.paddingTop=function(s){return arguments.length?(d=typeof s=="function"?s:q(+s),u):d},u.paddingRight=function(s){return arguments.length?(p=typeof s=="function"?s:q(+s),u):p},u.paddingBottom=function(s){return arguments.length?(g=typeof s=="function"?s:q(+s),u):g},u.paddingLeft=function(s){return arguments.length?(c=typeof s=="function"?s:q(+s),u):c},u}var Qe={nodes:[],levels:new Map,outerNodes:[],classes:new Map},V=new Ce(()=>structuredClone(Qe)),et=x(()=>{const e=be,a=ae();return ne({...e.treemap,...a.treemap??{}})},"getConfig"),tt=x(()=>V.records.nodes,"getNodes"),at=x((e,a)=>{const r=V.records;r.nodes.push(e),r.levels.set(e,a),a===0&&r.outerNodes.push(e),a===0&&!r.root&&(r.root=e)},"addNode"),nt=x(()=>({name:"",children:V.records.outerNodes}),"getRoot"),rt=x((e,a)=>{const r=V.records.classes,n=r.get(e)??{id:e,styles:[],textStyles:[]};r.set(e,n);const i=a.replace(/\\,/g,"§§§").replace(/,/g,";").replace(/§§§/g,",").split(";");i&&i.forEach(l=>{ye(l)&&(n!=null&&n.textStyles?n.textStyles.push(l):n.textStyles=[l]),n!=null&&n.styles?n.styles.push(l):n.styles=[l]}),r.set(e,n)},"addClass"),lt=x(()=>V.records.classes,"getClasses"),st=x(e=>{var a;return((a=V.records.classes.get(e))==null?void 0:a.styles)??[]},"getStylesForClass"),ot=x(()=>{Se(),V.reset()},"clear"),j={getNodes:tt,addNode:at,getRoot:nt,getConfig:et,clear:ot,setAccTitle:ue,getAccTitle:pe,setDiagramTitle:he,getDiagramTitle:fe,getAccDescription:ge,setAccDescription:me,addClass:rt,getClasses:lt,getStylesForClass:st};function re(e){if(!e.length)return[];const a=[],r=[];return e.forEach(n=>{const i={name:n.name,children:n.type==="Leaf"?void 0:[]};for(i.classSelector=n==null?void 0:n.classSelector,n!=null&&n.cssCompiledStyles&&(i.cssCompiledStyles=[n.cssCompiledStyles]),n.type==="Leaf"&&n.value!==void 0&&(i.value=n.value);r.length>0&&r[r.length-1].level>=n.level;)r.pop();if(r.length===0)a.push(i);else{const l=r[r.length-1].node;l.children?l.children.push(i):l.children=[i]}n.type!=="Leaf"&&r.push({node:i,level:n.level})}),a}x(re,"buildHierarchy");var it=x(e=>{we(e,j);const a=[];for(const i of e.TreemapRows??[])i.$type==="ClassDefStatement"&&j.addClass(i.className??"",i.styleText??"");for(const i of e.TreemapRows??[]){const l=i.item;if(!l)continue;const d=i.indent?parseInt(i.indent):0,p=ct(l),g=l.classSelector?j.getStylesForClass(l.classSelector):[],c=g.length>0?g.join(";"):void 0,u={level:d,name:p,type:l.$type,value:l.value,classSelector:l.classSelector,cssCompiledStyles:c};a.push(u)}const r=re(a),n=x((i,l)=>{for(const d of i)j.addNode(d,l),d.children&&d.children.length>0&&n(d.children,l+1)},"addNodesRecursively");n(r,0)},"populate"),ct=x(e=>e.name?String(e.name):"","getItemName"),dt={parse:x(async e=>{try{const r=await Le("treemap",e);Q.debug("Treemap AST:",r),it(r)}catch(a){throw Q.error("Error parsing treemap:",a),a}},"parse")},ut=10,D=10,X=25,pt=x((e,a,r,n)=>{const i=n.db,l=i.getConfig(),d=l.padding??ut,p=i.getDiagramTitle(),g=i.getRoot(),{themeVariables:c}=ae();if(!g)return;const u=p?30:0,w=ve(a),s=l.nodeWidth?l.nodeWidth*D:960,b=l.nodeHeight?l.nodeHeight*D:500,S=s,v=b+u;w.attr("viewBox",`0 0 ${S} ${v}`),xe(w,v,S,l.useMaxWidth);let h;try{const t=l.valueFormat||",";if(t==="$0,0")h=x(o=>"$"+O(",")(o),"valueFormat");else if(t.startsWith("$")&&t.includes(",")){const o=/\.\d+/.exec(t),f=o?o[0]:"";h=x(C=>"$"+O(","+f)(C),"valueFormat")}else if(t.startsWith("$")){const o=t.substring(1);h=x(f=>"$"+O(o||"")(f),"valueFormat")}else h=O(t)}catch(t){Q.error("Error creating format function:",t),h=O(",")}const m=K().range(["transparent",c.cScale0,c.cScale1,c.cScale2,c.cScale3,c.cScale4,c.cScale5,c.cScale6,c.cScale7,c.cScale8,c.cScale9,c.cScale10,c.cScale11]),A=K().range(["transparent",c.cScalePeer0,c.cScalePeer1,c.cScalePeer2,c.cScalePeer3,c.cScalePeer4,c.cScalePeer5,c.cScalePeer6,c.cScalePeer7,c.cScalePeer8,c.cScalePeer9,c.cScalePeer10,c.cScalePeer11]),k=K().range([c.cScaleLabel0,c.cScaleLabel1,c.cScaleLabel2,c.cScaleLabel3,c.cScaleLabel4,c.cScaleLabel5,c.cScaleLabel6,c.cScaleLabel7,c.cScaleLabel8,c.cScaleLabel9,c.cScaleLabel10,c.cScaleLabel11]);p&&w.append("text").attr("x",S/2).attr("y",u/2).attr("class","treemapTitle").attr("text-anchor","middle").attr("dominant-baseline","middle").text(p);const P=w.append("g").attr("transform",`translate(0, ${u})`).attr("class","treemapContainer"),W=ee(g).sum(t=>t.value??0).sort((t,o)=>(o.value??0)-(t.value??0)),te=Ke().size([s,b]).paddingTop(t=>t.children&&t.children.length>0?X+D:0).paddingInner(d).paddingLeft(t=>t.children&&t.children.length>0?D:0).paddingRight(t=>t.children&&t.children.length>0?D:0).paddingBottom(t=>t.children&&t.children.length>0?D:0).round(!0)(W),le=te.descendants().filter(t=>t.children&&t.children.length>0),E=P.selectAll(".treemapSection").data(le).enter().append("g").attr("class","treemapSection").attr("transform",t=>`translate(${t.x0},${t.y0})`);E.append("rect").attr("width",t=>t.x1-t.x0).attr("height",X).attr("class","treemapSectionHeader").attr("fill","none").attr("fill-opacity",.6).attr("stroke-width",.6).attr("style",t=>t.depth===0?"display: none;":""),E.append("clipPath").attr("id",(t,o)=>`clip-section-${a}-${o}`).append("rect").attr("width",t=>Math.max(0,t.x1-t.x0-12)).attr("height",X),E.append("rect").attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).attr("class",(t,o)=>`treemapSection section${o}`).attr("fill",t=>m(t.data.name)).attr("fill-opacity",.6).attr("stroke",t=>A(t.data.name)).attr("stroke-width",2).attr("stroke-opacity",.4).attr("style",t=>{if(t.depth===0)return"display: none;";const o=R({cssCompiledStyles:t.data.cssCompiledStyles});return o.nodeStyles+";"+o.borderStyles.join(";")}),E.append("text").attr("class","treemapSectionLabel").attr("x",6).attr("y",X/2).attr("dominant-baseline","middle").text(t=>t.depth===0?"":t.data.name).attr("font-weight","bold").attr("style",t=>{if(t.depth===0)return"display: none;";const o="dominant-baseline: middle; font-size: 12px; fill:"+k(t.data.name)+"; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",f=R({cssCompiledStyles:t.data.cssCompiledStyles});return o+f.labelStyles.replace("color:","fill:")}).each(function(t){if(t.depth===0)return;const o=U(this),f=t.data.name;o.text(f);const C=t.x1-t.x0,$=6;let F;l.showValues!==!1&&t.value?F=C-10-30-10-$:F=C-$-6;const N=Math.max(15,F),y=o.node();if(y.getComputedTextLength()>N){const L="...";let T=f;for(;T.length>0;){if(T=f.substring(0,T.length-1),T.length===0){o.text(L),y.getComputedTextLength()>N&&o.text("");break}if(o.text(T+L),y.getComputedTextLength()<=N)break}}}),l.showValues!==!1&&E.append("text").attr("class","treemapSectionValue").attr("x",t=>t.x1-t.x0-10).attr("y",X/2).attr("text-anchor","end").attr("dominant-baseline","middle").text(t=>t.value?h(t.value):"").attr("font-style","italic").attr("style",t=>{if(t.depth===0)return"display: none;";const o="text-anchor: end; dominant-baseline: middle; font-size: 10px; fill:"+k(t.data.name)+"; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",f=R({cssCompiledStyles:t.data.cssCompiledStyles});return o+f.labelStyles.replace("color:","fill:")});const se=te.leaves(),Y=P.selectAll(".treemapLeafGroup").data(se).enter().append("g").attr("class",(t,o)=>`treemapNode treemapLeafGroup leaf${o}${t.data.classSelector?` ${t.data.classSelector}`:""}x`).attr("transform",t=>`translate(${t.x0},${t.y0})`);Y.append("rect").attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).attr("class","treemapLeaf").attr("fill",t=>t.parent?m(t.parent.data.name):m(t.data.name)).attr("style",t=>R({cssCompiledStyles:t.data.cssCompiledStyles}).nodeStyles).attr("fill-opacity",.3).attr("stroke",t=>t.parent?m(t.parent.data.name):m(t.data.name)).attr("stroke-width",3),Y.append("clipPath").attr("id",(t,o)=>`clip-${a}-${o}`).append("rect").attr("width",t=>Math.max(0,t.x1-t.x0-4)).attr("height",t=>Math.max(0,t.y1-t.y0-4)),Y.append("text").attr("class","treemapLabel").attr("x",t=>(t.x1-t.x0)/2).attr("y",t=>(t.y1-t.y0)/2).attr("style",t=>{const o="text-anchor: middle; dominant-baseline: middle; font-size: 38px;fill:"+k(t.data.name)+";",f=R({cssCompiledStyles:t.data.cssCompiledStyles});return o+f.labelStyles.replace("color:","fill:")}).attr("clip-path",(t,o)=>`url(#clip-${a}-${o})`).text(t=>t.data.name).each(function(t){const o=U(this),f=t.x1-t.x0,C=t.y1-t.y0,$=o.node(),F=4,B=f-2*F,N=C-2*F;if(B<10||N<10){o.style("display","none");return}let y=parseInt(o.style("font-size"),10);const z=8,L=28,T=.6,M=6,I=2;for(;$.getComputedTextLength()>B&&y>z;)y--,o.style("font-size",`${y}px`);let H=Math.max(M,Math.min(L,Math.round(y*T))),J=y+I+H;for(;J>N&&y>z&&(y--,H=Math.max(M,Math.min(L,Math.round(y*T))),!(H<M&&y===z));)o.style("font-size",`${y}px`),J=y+I+H;o.style("font-size",`${y}px`),($.getComputedTextLength()>B||y<z||N<y)&&o.style("display","none")}),l.showValues!==!1&&Y.append("text").attr("class","treemapValue").attr("x",o=>(o.x1-o.x0)/2).attr("y",function(o){return(o.y1-o.y0)/2}).attr("style",o=>{const f="text-anchor: middle; dominant-baseline: hanging; font-size: 28px;fill:"+k(o.data.name)+";",C=R({cssCompiledStyles:o.data.cssCompiledStyles});return f+C.labelStyles.replace("color:","fill:")}).attr("clip-path",(o,f)=>`url(#clip-${a}-${f})`).text(o=>o.value?h(o.value):"").each(function(o){const f=U(this),C=this.parentNode;if(!C){f.style("display","none");return}const $=U(C).select(".treemapLabel");if($.empty()||$.style("display")==="none"){f.style("display","none");return}const F=parseFloat($.style("font-size")),B=28,N=.6,y=6,z=2,L=Math.max(y,Math.min(B,Math.round(F*N)));f.style("font-size",`${L}px`);const M=(o.y1-o.y0)/2+F/2+z;f.attr("y",M);const I=o.x1-o.x0,ie=o.y1-o.y0-4,ce=I-2*4;f.node().getComputedTextLength()>ce||M+L>ie||L<y?f.style("display","none"):f.style("display",null)});const oe=l.diagramPadding??8;de(w,oe,"flowchart",(l==null?void 0:l.useMaxWidth)||!1)},"draw"),ht=x(function(e,a){return a.db.getClasses()},"getClasses"),ft={draw:pt,getClasses:ht},gt={sectionStrokeColor:"black",sectionStrokeWidth:"1",sectionFillColor:"#efefef",leafStrokeColor:"black",leafStrokeWidth:"1",leafFillColor:"#efefef",labelColor:"black",labelFontSize:"12px",valueFontSize:"10px",valueColor:"black",titleColor:"black",titleFontSize:"14px"},mt=x(({treemap:e}={})=>{const a=ne(gt,e);return`
  .treemapNode.section {
    stroke: ${a.sectionStrokeColor};
    stroke-width: ${a.sectionStrokeWidth};
    fill: ${a.sectionFillColor};
  }
  .treemapNode.leaf {
    stroke: ${a.leafStrokeColor};
    stroke-width: ${a.leafStrokeWidth};
    fill: ${a.leafFillColor};
  }
  .treemapLabel {
    fill: ${a.labelColor};
    font-size: ${a.labelFontSize};
  }
  .treemapValue {
    fill: ${a.valueColor};
    font-size: ${a.valueFontSize};
  }
  .treemapTitle {
    fill: ${a.titleColor};
    font-size: ${a.titleFontSize};
  }
  `},"getStyles"),yt=mt,Bt={parser:dt,db:j,renderer:ft,styles:yt};export{Bt as diagram};
